"use strict";var View={listDay:["понедельник","вторник","среда","четверг","пятница","суббота","воскресенье"],listMonth:["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"],listMonths:["января","февраля","марта","апреля","майа","июня","июля","августа","сентября","октября","ноября","декабря"],buttonFastAdd:document.getElementById("btn-fast-add"),popupFastAdd:document.getElementById("popup-fast-add"),inputFastAdd:document.getElementById("pfa-input"),statusFastAdd:document.getElementById("pfa-status"),buttonSubmitFastAdd:document.getElementById("pfa-btn-submit"),buttonCancelFastAdd:document.getElementById("pfa-btn-canсel"),buttonCloseFastAdd:document.getElementById("pfa-btn-close"),buttonUpdate:document.getElementById("btn-update"),inputSerach:document.getElementById("input-search"),resultSerach:document.getElementById("search-result"),itemSearch:document.getElementsByClassName("sr-item"),buttonEarlier:document.getElementById("btn-earlier"),buttonLater:document.getElementById("btn-later"),buttonCurrent:document.getElementById("btn-current"),buttonMonth:document.getElementById("btn-month"),popupMonth:document.getElementById("popup-month"),listPopupMonth:document.getElementsByClassName("pm-item"),buttonYear:document.getElementById("btn-year"),popupYear:document.getElementById("popup-year"),listPopupYear:document.getElementsByClassName("py-item"),calendar:document.getElementById("calendar"),colsCalendar:document.getElementsByClassName("col"),popupAdd:document.getElementById("popup-add"),headerAdd:document.getElementById("pa-header"),inputTitleAdd:document.getElementById("pa-input-title"),inputUserAdd:document.getElementById("pa-input-users"),textareaAdd:document.getElementById("pa-descr"),statusAdd:document.getElementById("pa-status"),buttonSubmitAdd:document.getElementById("pa-btn-sumbit"),buttonCancelAdd:document.getElementById("pa-btn-cancel"),buttonCloseAdd:document.getElementById("pa-btn-close"),popupEdit:document.getElementById("popup-edit"),headerEdit:document.getElementById("pe-header"),dateEdit:document.getElementById("pe-date"),lableEdit:document.getElementById("pe-user"),inputUserEdit:document.getElementById("pe-input-users"),usersEdit:document.getElementById("pe-users"),textareaEdit:document.getElementById("pe-descr"),statusEdit:document.getElementById("pe-status"),buttonSubmitEdit:document.getElementById("pe-btn-sumbit"),buttonDeleteEdit:document.getElementById("pe-btn-delete"),buttonCloseEdit:document.getElementById("pe-btn-close"),createDivWithClass:function(e){var t=document.createElement("div");return t.classList.add(e),t},changeLableMonth:function(){var e=this.listMonth[Model.date.getMonth()];this.buttonMonth.innerHTML=e[0].toUpperCase()+e.slice(1)},createItemsMonth:function(){this.popupMonth.innerHTML="";for(var e=0;e<this.listMonth.length;e++){var t=this.createDivWithClass("pm-item"),i=this.listMonth[e];t.setAttribute("id","pm-item"),t.innerHTML=i[0].toUpperCase()+i.slice(1),this.popupMonth.appendChild(t)}},markItemMonth:function(){for(var e=0;e<this.listPopupMonth.length;e++)this.listPopupMonth[e].classList.remove("active");this.listPopupMonth[Model.date.getMonth()].classList.add("active")},changeLableYear:function(){this.buttonYear.innerHTML=Model.date.getFullYear()},createItemsYear:function(){var e=Model.getListYear();this.popupYear.innerHTML="";for(var t=0;t<e.length;t++){var i=this.createDivWithClass("py-item");i.setAttribute("id","py-item"),i.innerHTML=e[t],this.popupYear.appendChild(i)}},markItemYear:function(){for(var e=0;e<this.listPopupYear.length;e++)this.listPopupYear[e].innerHTML==Model.date.getFullYear()?this.listPopupYear[e].classList.add("active"):this.listPopupYear[e].classList.remove("active")},showSelectedMonth:function(){var e=Model.getDaysCurrentMonth(),t=e.length/7,i=0,n=e[17][1];this.colsCalendar=[],this.calendar.innerHTML="";for(var a=0;a<t;a++){for(var o=this.createDivWithClass("row"),d=0;d<7;d++){var s=this.createDivWithClass("col");s.setAttribute("date-index",Model.getIndexDate(e[i])),e[i][1]!=n&&s.classList.add("unfit"),Model.ifToday(e[i])&&s.classList.add("current");var r=this.createDivWithClass("col-date");if(r.innerHTML=0==a?this.listDay[d]+", "+e[i][2]:e[i][2],s.appendChild(r),Model.ifEvent(e[i])){s.classList.add("event");var l=this.createDivWithClass("col-title"),u=this.createDivWithClass("col-descr"),c=Model.getEvent(e[i]),h=""!=c.users?c.users:c.descr;l.innerHTML=c.title,u.innerHTML=h.length>40?h.slice(0,41)+" ...":h,s.appendChild(l),s.appendChild(u)}o.appendChild(s),i++}this.calendar.appendChild(o)}Model.refreshColsEvent()},showStatusFastAdd:function(e,t){this.statusFastAdd.className="status",this.statusFastAdd.classList.add(e),this.statusFastAdd.innerHTML=t},showStatusAdd:function(e,t){this.statusAdd.className="status",this.statusAdd.classList.add(e),this.statusAdd.innerHTML=t},removeMarkColCalendar:function(){for(var e=0;e<this.colsCalendar.length;e++)this.colsCalendar[e].classList.remove("focus")},markColCalendar:function(e){e.classList.add("focus")},showPopupAdd:function(e){var t=Model.getDateIndex(e.getAttribute("date-index")),i=this.listMonths[t[1]];this.headerAdd.innerHTML=t[2]+" "+i[0].toUpperCase()+i.slice(1),this.statusAdd.innerHTML="",this.popupAdd.classList.add("active"),this.popupAdd.setAttribute("date-index",e.getAttribute("date-index"))},hidePopupAdd:function(){this.popupAdd.classList.remove("active"),this.inputTitleAdd.value="",this.inputUserAdd.value="",this.textareaAdd.value="",this.headerAdd.innerHTML=""},showPopupEdit:function(e){var t=e.getAttribute("date-index"),i=Model.getDateIndex(t),n=Model.getEvent(i),a=this.listMonths[i[1]];this.headerEdit.innerHTML=n.title,this.dateEdit.innerHTML=i[2]+" "+a[0].toUpperCase()+a.slice(1),this.inputUserEdit.value="",""!=n.users?(this.inputUserEdit.style.display="none",this.lableEdit.style.display="block",this.usersEdit.innerHTML=n.users):(this.inputUserEdit.style.display="block",this.lableEdit.style.display="none"),this.textareaEdit.value=n.descr,this.popupEdit.classList.add("active"),this.popupEdit.setAttribute("date-index",t)},hidePopupEdit:function(){this.popupEdit.classList.remove("active"),this.headerEdit.innerHTML="",this.dateEdit.innerHTML="",this.usersEdit.innerHTML="",this.textareaEdit.value=""},showSearchResult:function(e){this.resultSerach.innerHTML="",this.resultSerach.classList.add("active");for(var t=0;t<e.length;t++){var i=Model.getDateIndex(e[t]),n=this.createDivWithClass("sr-item");n.setAttribute("date-index",e[t]);var a=this.createDivWithClass("sri-title"),o=this.createDivWithClass("sri-date");a.innerHTML=Model.events[e[t]].title;var d=this.listMonths[i[1]];o.innerHTML=i[2]+" "+d[0].toUpperCase()+d.slice(1)+" "+i[0],n.appendChild(a),n.appendChild(o),this.resultSerach.appendChild(n)}Model.refreshItemSearch()},hideSearchResult:function(){this.resultSerach.innerHTML="",this.resultSerach.classList.remove("active")},onfocusSearch:function(){this.inputSerach.value="",this.resultSerach.innerHTML="",this.resultSerach.classList.remove("active")},showPopupFastAdd:function(){this.popupFastAdd.classList.add("active")},hidePopupFastAdd:function(){this.popupFastAdd.classList.remove("active"),this.statusFastAdd.innerHTML="",this.inputFastAdd.value=""},showPopupMonth:function(){View.popupMonth.classList.add("active")},hidePopupMonth:function(){View.popupMonth.classList.remove("active")},showPopupYear:function(){View.popupYear.classList.add("active")},hidePopupYear:function(){View.popupYear.classList.remove("active")}},Model={date:new Date,events:{},readJsonFile:function(){for(var e=JSON.parse(FILE),t=0;t<e.length;t++){var i=e[t].date;this.events[i]={title:e[t].title,users:e[t].users,descr:e[t].descr}}},ifToday:function(e){var t=new Date,i=t.getFullYear(),n=t.getMonth(),a=t.getDate();return e[0]==i&&e[1]==n&&e[2]==a},ifEvent:function(e){return this.getIndexDate(e)in this.events},getEvent:function(e){return this.events[this.getIndexDate(e)]},setCurrentDate:function(){this.date=new Date},setSelectedMonth:function(e){this.date.setMonth(e)},setSelectedYear:function(e){this.date.setFullYear(e)},setEarlierMonth:function(){this.date.setMonth(this.date.getMonth()-1)},setLaterMonth:function(){this.date.setMonth(this.date.getMonth()+1)},getDaysCurrentMonth:function(){var e=[],t=this.date.getMonth(),i=new Date;i.setFullYear(this.date.getFullYear(),t,1);var n=0==i.getDay()?7:i.getDay();i.setDate(i.getDate()-n+1);for(a=0;a<7;a++)e.push([i.getFullYear(),i.getMonth(),i.getDate()]),i.setDate(i.getDate()+1);for(;i.getMonth()==t;)for(var a=0;a<7;a++)e.push([i.getFullYear(),i.getMonth(),i.getDate()]),i.setDate(i.getDate()+1);return e},getIndexDate:function(e){var t=1==(""+e[1]).length?"0"+(e[1]+1):e[1]+1,i=1==(""+e[2]).length?"0"+e[2]:e[2];return[e[0],t,i].join("")},getDateIndex:function(e){var t=[];return t.push(+e.slice(0,4)),t.push(+("0"==e[4]?e[5]:e.slice(4,6))-1),t.push(+("0"==e[6]?e[7]:e.slice(6))),t},getListYear:function(){for(var e=[],t=+this.date.getFullYear()-20;t<+this.date.getFullYear()+50;t++)e.push(t);return e},splitStrFastAdd:function(e){var t=e.split(", ")[0].split(" ");if(t.length<2)return!1;for(var i=[],n=0;n<t.length;n++)""!=t[n]&&i.push(t[n].trim());if(i.length<2)return!1;i[1].toLowerCase();var a=!1;if(-1!=View.listMonths.indexOf(i[1]))a=View.listMonths.indexOf(i[1]);else{if(-1==View.listMonth.indexOf(i[1]))return!1;a=View.listMonth.indexOf(i[1])}return[Model.date.getFullYear(),a,+i[0],e.slice(e.indexOf(",")+2).trim()]},ifDayBelongMonth:function(e){var t=new Date(e[0],e[1]+1,1);return t.setDate(t.getDate()-1),!(t.getDate()>=e[2])},ifCorrectFastAdd:function(e){return!1!==e[1]&&(e[2]>0&&e[2]<32&&!this.ifDayBelongMonth(e.slice(0,3)))},saveEventFastAdd:function(e){var t=this.splitStrFastAdd(e);if(this.ifCorrectFastAdd(t)){var i=this.getIndexDate([t[0],t[1],t[2]]);return this.setSelectedMonth(t[1]),this.ifEvent(this.getDateIndex(i))?"busy":(this.events[i]={title:t[3],users:"",descr:""},!0)}},refreshColsEvent:function(){View.colsCalendar=document.getElementsByClassName("col");for(var e=0;e<View.colsCalendar.length;e++)View.colsCalendar[e].addEventListener("click",function(e){Controller.clickColCalendar(e)})},setCoordinates:function(e,t,i){var n={right:Math.round(i.right+20),bottom:Math.round(i.bottom-20)},a={left:Math.round(t.left-10),right:Math.round(t.right+10),top:Math.round(t.top+10)};e.style.left=n.right-a.right>300?a.right+"px":a.left-300+"px",e.style.top=n.bottom-a.top>375?a.top+"px":n.bottom-375+"px"},deleteEvent:function(e){delete this.events[e]},saveNewEvent:function(e,t){this.events[e]={title:t[0],users:t[1],descr:t[2]}},saveEvent:function(e,t){""!=t[0]&&(this.events[e].users=t[0]),""!=t[1]&&(this.events[e].descr=t[1])},searchEvents:function(e){if(""==e||"string"!=typeof e)return!1;for(var t=e.split(" "),i={},n=0;n<t.length;n++){t[n]=(""+t[n]).toLowerCase();for(var a in this.events){var o=this.getDateIndex(a);""+o[0]!=t[n]?-1==View.listMonths[o[1]].indexOf(t[n])&&-1==View.listMonth[o[1]].indexOf(t[n])&&-1==(""+o[2]).indexOf(t[n])&&-1==this.events[a].title.toLowerCase().indexOf(t[n])&&-1==this.events[a].users.toLowerCase().indexOf(t[n])?-1==this.events[a].descr.toLowerCase().indexOf(t[n])||(void 0!==i[a]?i[a]++:i[a]=1):void 0!==i[a]?i[a]++:i[a]=1:void 0!==i[a]?i[a]++:i[a]=1}}var d=[];for(var a in i)i[a]==t.length&&d.push(a);return!(d.length<1)&&d},refreshItemSearch:function(){View.itemSearch=document.getElementsByClassName("sr-item");for(var e=0;e<View.itemSearch.length;e++)View.itemSearch[e].addEventListener("click",function(e){Controller.clickItemSearch(e)})}},Controller={clickButtonEarlier:function(){Model.setEarlierMonth(),View.changeLableMonth(),View.changeLableYear(),View.markItemMonth(),View.markItemYear(),View.showSelectedMonth(),View.removeMarkColCalendar(),View.onfocusSearch(),View.hidePopupAdd(),View.hidePopupEdit(),View.hidePopupFastAdd()},clickButtonLater:function(){Model.setLaterMonth(),View.changeLableMonth(),View.changeLableYear(),View.markItemMonth(),View.markItemYear(),View.showSelectedMonth(),View.removeMarkColCalendar(),View.onfocusSearch(),View.hidePopupAdd(),View.hidePopupEdit(),View.hidePopupFastAdd()},clickButtonCurrent:function(){Model.setCurrentDate(),View.changeLableMonth(),View.changeLableYear(),View.markItemMonth(),View.markItemYear(),View.showSelectedMonth(),View.removeMarkColCalendar(),View.onfocusSearch(),View.hidePopupAdd(),View.hidePopupEdit(),View.hidePopupFastAdd()},clickButtonMonth:function(e){e.target==View.buttonMonth&&(View.removeMarkColCalendar(),View.onfocusSearch(),View.hidePopupAdd(),View.hidePopupEdit(),View.hidePopupFastAdd(),View.popupMonth.classList.contains("active")?View.hidePopupMonth():View.showPopupMonth()),e.target!=View.buttonMonth&&View.popupMonth.classList.contains("active")&&View.hidePopupMonth()},clickItemMonth:function(e){var t=e.target.innerHTML,i=View.listMonth.indexOf(t.toLowerCase());Model.setSelectedMonth(i),View.changeLableMonth(),View.changeLableYear(),View.markItemMonth(),View.markItemYear(),View.showSelectedMonth()},clickButtonYear:function(e){e.target==View.buttonYear&&(View.removeMarkColCalendar(),View.onfocusSearch(),View.hidePopupAdd(),View.hidePopupEdit(),View.hidePopupFastAdd(),View.popupYear.classList.contains("active")?View.hidePopupYear():View.showPopupYear()),e.target!=View.buttonYear&&View.popupYear.classList.contains("active")&&View.hidePopupYear()},clickItemYear:function(e){Model.setSelectedYear(e.target.innerHTML),View.changeLableMonth(),View.changeLableYear(),View.markItemMonth(),View.markItemYear(),View.showSelectedMonth()},clickButtonFastAdd:function(){View.removeMarkColCalendar(),View.onfocusSearch(),View.hidePopupAdd(),View.hidePopupEdit(),View.popupFastAdd.classList.contains("active")?View.hidePopupFastAdd():View.showPopupFastAdd()},clickButtonCloseFastAdd:function(){View.hidePopupFastAdd()},clickButtonCancelFastAdd:function(){View.hidePopupFastAdd()},clickButtonSumbitFastAdd:function(){var e=View.inputFastAdd.value;if(""==e)View.showStatusFastAdd("error","Заполните поле");else{var t=Model.saveEventFastAdd(e);"busy"==t?(View.showStatusFastAdd("info","День занят"),View.changeLableMonth(),View.markItemMonth(),View.showSelectedMonth()):t&&"busy"!=t?(View.showStatusFastAdd("succses","Данные добавлены"),View.changeLableMonth(),View.markItemMonth(),View.showSelectedMonth(),e=""):View.showStatusFastAdd("error","Данные некорректны")}},clickButtonUpdate:function(){Model.events={},Model.setCurrentDate(),View.changeLableMonth(),View.changeLableYear(),View.markItemMonth(),View.markItemYear(),View.showSelectedMonth(),View.removeMarkColCalendar(),View.onfocusSearch(),View.hidePopupAdd(),View.hidePopupEdit(),View.hidePopupFastAdd()},clickColCalendar:function(e){if(e.target.classList.contains("col"))t=e.target;else var t=e.target.parentNode;View.removeMarkColCalendar(),View.onfocusSearch(),View.hidePopupAdd(),View.hidePopupEdit(),View.hidePopupFastAdd(),t.classList.contains("focus")||(View.markColCalendar(t),t.classList.contains("event")?(Model.setCoordinates(View.popupEdit,t.getBoundingClientRect(),t.parentNode.parentNode.getBoundingClientRect()),View.showPopupEdit(t)):(Model.setCoordinates(View.popupAdd,t.getBoundingClientRect(),t.parentNode.parentNode.getBoundingClientRect()),View.showPopupAdd(t)))},clickButtonCloseAdd:function(){View.removeMarkColCalendar(),View.hidePopupAdd()},clickButtonCancelAdd:function(){View.removeMarkColCalendar(),View.hidePopupAdd()},clickButtonSumbitAdd:function(e){var t=e.target.parentNode.parentNode.getAttribute("date-index");if(""==View.inputTitleAdd.value)View.showStatusAdd("error",'Заполните поле "Событие"');else{var i=[View.inputTitleAdd.value,View.inputUserAdd.value,View.textareaAdd.value];Model.saveNewEvent(t,i),View.removeMarkColCalendar(),View.hidePopupAdd(),View.showSelectedMonth()}},clickButtonCloseEdit:function(){View.removeMarkColCalendar(),View.hidePopupEdit()},clickButtonDeleteEdit:function(e){var t=e.target.parentNode.parentNode.getAttribute("date-index");Model.deleteEvent(t),View.removeMarkColCalendar(),View.hidePopupEdit(),View.showSelectedMonth()},clickButtonSumbitEdit:function(e){var t=e.target.parentNode.parentNode.getAttribute("date-index");if("block"==View.inputUserEdit.style.display)i=View.inputUserEdit.value;else if("block"==View.lableEdit.style.display)var i=View.usersEdit.innerHTML;var n=[i,View.textareaEdit.value];Model.saveEvent(t,n),View.removeMarkColCalendar(),View.hidePopupEdit(),View.showSelectedMonth()},focusInputSerach:function(){View.removeMarkColCalendar(),View.hidePopupAdd(),View.hidePopupEdit(),View.hidePopupFastAdd()},keyupInputSerach:function(){Model.refreshItemSearch();var e=Model.searchEvents(View.inputSerach.value);e?View.showSearchResult(e):View.hideSearchResult()},clickItemSearch:function(e){if(e.target.classList.contains("sr-item"))t=e.target;else var t=e.target.parentNode;var i=t.getAttribute("date-index"),n=Model.getDateIndex(i);console.log(i),console.log(n)}};({init:function(){Model.readJsonFile(),Model.setCurrentDate(),View.createItemsYear(),View.createItemsMonth(),View.changeLableMonth(),View.changeLableYear(),View.markItemMonth(),View.markItemYear(),View.showSelectedMonth(),this.main(),this.event()},main:function(){},event:function(){View.buttonFastAdd.addEventListener("click",Controller.clickButtonFastAdd),View.buttonUpdate.addEventListener("click",Controller.clickButtonUpdate),View.buttonCloseFastAdd.addEventListener("click",Controller.clickButtonCloseFastAdd),View.buttonCancelFastAdd.addEventListener("click",Controller.clickButtonCancelFastAdd),View.buttonSubmitFastAdd.addEventListener("click",Controller.clickButtonSumbitFastAdd),View.buttonEarlier.addEventListener("click",Controller.clickButtonEarlier),View.buttonLater.addEventListener("click",Controller.clickButtonLater),View.buttonCurrent.addEventListener("click",Controller.clickButtonCurrent),window.addEventListener("click",function(e){Controller.clickButtonMonth(e)});for(e=0;e<View.listPopupMonth.length;e++)View.listPopupMonth[e].addEventListener("click",function(e){Controller.clickItemMonth(e)});window.addEventListener("click",function(e){Controller.clickButtonYear(e)});for(var e=0;e<View.listPopupYear.length;e++)View.listPopupYear[e].addEventListener("click",function(e){Controller.clickItemYear(e)});View.buttonCloseAdd.addEventListener("click",Controller.clickButtonCloseAdd),View.buttonCancelAdd.addEventListener("click",Controller.clickButtonCancelAdd),View.buttonSubmitAdd.addEventListener("click",function(e){Controller.clickButtonSumbitAdd(e)}),View.buttonCloseEdit.addEventListener("click",Controller.clickButtonCloseEdit),View.buttonDeleteEdit.addEventListener("click",function(e){Controller.clickButtonDeleteEdit(e)}),View.buttonSubmitEdit.addEventListener("click",function(e){Controller.clickButtonSumbitEdit(e)}),View.inputSerach.addEventListener("focus",Controller.focusInputSerach),View.inputSerach.addEventListener("keyup",Controller.keyupInputSerach)}}).init();