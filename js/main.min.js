"use strict";var View={listDay:["понедельник","вторник","среда","четверг","пятница","суббота","воскресенье"],listMonth:["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"],listMonths:["января","февраля","марта","апреля","майа","июня","июля","августа","сентября","октября","ноября","декабря"],buttonFastAdd:document.getElementById("btn-fast-add"),popupFastAdd:document.getElementById("popup-fast-add"),inputFastAdd:document.getElementById("pfa-input"),statusFastAdd:document.getElementById("pfa-status"),buttonSubmitFastAdd:document.getElementById("pfa-btn-submit"),buttonCancelFastAdd:document.getElementById("pfa-btn-canсel"),buttonCloseFastAdd:document.getElementById("pfa-btn-close"),buttonUpdate:document.getElementById("btn-update"),inputSerach:document.getElementById("input-search"),buttonEarlier:document.getElementById("btn-earlier"),buttonLater:document.getElementById("btn-later"),buttonCurrent:document.getElementById("btn-current"),buttonMonth:document.getElementById("btn-month"),popupMonth:document.getElementById("popup-month"),listPopupMonth:document.getElementsByClassName("pm-item"),buttonYear:document.getElementById("btn-year"),popupYear:document.getElementById("popup-year"),listPopupYear:document.getElementsByClassName("py-item"),calendar:document.getElementById("calendar"),colsCalendar:document.getElementsByClassName("col"),popupAdd:document.getElementById("popup-add"),headerAdd:document.getElementById("pa-header"),inputTitleAdd:document.getElementById("pa-input-title"),inputUserAdd:document.getElementById("pa-input-users"),textareaAdd:document.getElementById("pa-descr"),statusAdd:document.getElementById("pa-status"),buttonSubmitAdd:document.getElementById("pa-btn-sumbit"),buttonCancelAdd:document.getElementById("pa-btn-cancel"),buttonCloseAdd:document.getElementById("pa-btn-close"),popupEdit:document.getElementById("popup-edit"),headerEdit:document.getElementById("pe-header"),dateEdit:document.getElementById("pe-date"),lableEdit:document.getElementById("pe-user"),inputUserEdit:document.getElementById("pe-input-users"),usersEdit:document.getElementById("pe-users"),textareaEdit:document.getElementById("pe-descr"),statusEdit:document.getElementById("pe-status"),buttonSubmitEdit:document.getElementById("pe-btn-sumbit"),buttonDeleteEdit:document.getElementById("pe-btn-delete"),buttonCloseEdit:document.getElementById("pe-btn-close"),createDivWithClass:function(t){var e=document.createElement("div");return e.classList.add(t),e},changeLableMonth:function(){var t=this.listMonth[Model.date.getMonth()];this.buttonMonth.innerHTML=t[0].toUpperCase()+t.slice(1)},createItemsMonth:function(){this.popupMonth.innerHTML="";for(var t=0;t<this.listMonth.length;t++){var e=this.createDivWithClass("pm-item"),n=this.listMonth[t];e.setAttribute("id","pm-item"),e.innerHTML=n[0].toUpperCase()+n.slice(1),this.popupMonth.appendChild(e)}},markItemMonth:function(){for(var t=0;t<this.listPopupMonth.length;t++)this.listPopupMonth[t].classList.remove("active");this.listPopupMonth[Model.date.getMonth()].classList.add("active")},changeLableYear:function(){this.buttonYear.innerHTML=Model.date.getFullYear()},createItemsYear:function(){var t=Model.getListYear();this.popupYear.innerHTML="";for(var e=0;e<t.length;e++){var n=this.createDivWithClass("py-item");n.setAttribute("id","py-item"),n.innerHTML=t[e],this.popupYear.appendChild(n)}},markItemYear:function(){for(var t=0;t<this.listPopupYear.length;t++)this.listPopupYear[t].innerHTML==Model.date.getFullYear()?this.listPopupYear[t].classList.add("active"):this.listPopupYear[t].classList.remove("active")},showSelectedMonth:function(){var t=Model.getDaysCurrentMonth(),e=t.length/7,n=0,i=t[17][1];this.colsCalendar=[],this.calendar.innerHTML="";for(var d=0;d<e;d++){for(var a=this.createDivWithClass("row"),o=0;o<7;o++){var s=this.createDivWithClass("col");s.setAttribute("date-index",Model.getIndexDate(t[n])),t[n][1]!=i&&s.classList.add("unfit"),Model.ifToday(t[n])&&s.classList.add("current");var r=this.createDivWithClass("col-date");if(r.innerHTML=0==d?this.listDay[o]+", "+t[n][2]:t[n][2],s.appendChild(r),Model.ifEvent(t[n])){s.classList.add("event");var l=this.createDivWithClass("col-title"),u=this.createDivWithClass("col-descr"),c=Model.getEvent(t[n]),h=""!=c.users?c.users:c.descr;l.innerHTML=c.title,u.innerHTML=h.length>40?h.slice(0,41)+" ...":h,s.appendChild(l),s.appendChild(u)}a.appendChild(s),n++}this.calendar.appendChild(a)}Model.refreshColsEvent()},showStatusFastAdd:function(t,e){this.statusFastAdd.className="status",this.statusFastAdd.classList.add(t),this.statusFastAdd.innerHTML=e},removeMarkColCalendar:function(){for(var t=0;t<this.colsCalendar.length;t++)this.colsCalendar[t].classList.remove("focus")},markColCalendar:function(t){this.removeMarkColCalendar(),t.classList.add("focus")},showPopupAdd:function(t){var e=Model.getDateIndex(t.getAttribute("date-index")),n=this.listMonths[e[1]];this.headerAdd.innerHTML=e[2]+" "+n[0].toUpperCase()+n.slice(1),this.popupAdd.classList.add("active"),this.popupAdd.setAttribute("date-index",t.getAttribute("date-index"))},hidePopupAdd:function(){this.popupAdd.classList.remove("active"),this.inputTitleAdd.value="",this.inputUserAdd.value="",this.textareaAdd.value="",this.headerAdd.innerHTML=""},showPopupEdit:function(t){var e=t.getAttribute("date-index"),n=Model.getDateIndex(e),i=Model.getEvent(n),d=this.listMonths[n[1]];this.headerEdit.innerHTML=i.title,this.dateEdit.innerHTML=n[2]+" "+d[0].toUpperCase()+d.slice(1),""!=i.users?(this.inputUserEdit.style.display="none",this.usersEdit.innerHTML=i.users):(this.inputUserEdit.style.display="block",this.lableEdit.innerHTML=""),this.textareaEdit.value=i.descr,this.popupEdit.classList.add("active"),this.popupEdit.setAttribute("date-index",e)},hidePopupEdit:function(){this.popupEdit.classList.remove("active"),this.headerEdit.innerHTML="",this.dateEdit.innerHTML="",this.usersEdit.innerHTML="",this.textareaEdit.value=""}},Model={date:new Date,events:{},readJsonFile:function(){for(var t=JSON.parse(FILE),e=0;e<t.length;e++){var n=t[e].date;this.events[n]={title:t[e].title,users:t[e].users,descr:t[e].descr}}},ifToday:function(t){var e=new Date,n=e.getFullYear(),i=e.getMonth(),d=e.getDate();return t[0]==n&&t[1]==i&&t[2]==d},ifEvent:function(t){return this.getIndexDate(t)in this.events},getEvent:function(t){return this.events[this.getIndexDate(t)]},refresh:function(){Model.setCurrentDate(),Model.readJsonFile(),View.changeLableMonth(),View.markItemMonth(),View.changeLableYear(),View.markItemYear(),View.showSelectedMonth()},setCurrentDate:function(){this.date=new Date},setSelectedMonth:function(t){this.date.setMonth(t)},setSelectedYear:function(t){this.date.setFullYear(t)},setEarlierMonth:function(){this.date.setMonth(this.date.getMonth()-1)},setLaterMonth:function(){this.date.setMonth(this.date.getMonth()+1)},getDaysCurrentMonth:function(){var t=[],e=this.date.getMonth(),n=new Date;n.setFullYear(this.date.getFullYear(),e,1);var i=0==n.getDay()?7:n.getDay();n.setDate(n.getDate()-i+1);for(d=0;d<7;d++)t.push([n.getFullYear(),n.getMonth(),n.getDate()]),n.setDate(n.getDate()+1);for(;n.getMonth()==e;)for(var d=0;d<7;d++)t.push([n.getFullYear(),n.getMonth(),n.getDate()]),n.setDate(n.getDate()+1);return t},getIndexDate:function(t){var e=1==(""+t[1]).length?"0"+(t[1]+1):t[1]+1,n=1==(""+t[2]).length?"0"+t[2]:t[2];return[t[0],e,n].join("")},getDateIndex:function(t){var e=[];return e.push(+t.slice(0,4)),e.push(+("0"==t[4]?t[5]:t.slice(4,6))-1),e.push(+("0"==t[6]?t[7]:t.slice(6))),e},getListYear:function(){for(var t=[],e=+this.date.getFullYear()-20;e<+this.date.getFullYear()+50;e++)t.push(e);return t},splitStrFastAdd:function(t){var e=t.split(", ")[0].split(" ");if(e.length<2)return!1;for(var n=[],i=0;i<e.length;i++)""!=e[i]&&n.push(e[i].trim());if(n.length<2)return!1;n[1].toLowerCase();var d=!1;if(-1!=View.listMonths.indexOf(n[1]))d=View.listMonths.indexOf(n[1]);else{if(-1==View.listMonth.indexOf(n[1]))return!1;d=View.listMonth.indexOf(n[1])}return[Model.date.getFullYear(),d,+n[0],t.slice(t.indexOf(",")+2).trim()]},ifDayBelongMonth:function(t){var e=new Date(t[0],t[1]+1,1);return e.setDate(e.getDate()-1),!(e.getDate()>=t[2])},ifCorrectFastAdd:function(t){return!!t[1]&&(t[2]>0&&t[2]<32&&!this.ifDayBelongMonth(t.slice(0,3)))},saveEventFastAdd:function(t){var e=this.splitStrFastAdd(t);if(this.ifCorrectFastAdd(e)){var n=this.getIndexDate([e[0],e[1],e[2]]);return this.setSelectedMonth(e[1]),this.ifEvent(this.getDateIndex(n))?"busy":(this.events[n]={title:e[3],users:"",descr:""},!0)}},refreshColsEvent:function(){View.colsCalendar=document.getElementsByClassName("col");for(var t=0;t<View.colsCalendar.length;t++)View.colsCalendar[t].addEventListener("click",function(t){Controller.clickColCalendar(t)})},setCoordinates:function(t,e,n){var i={right:Math.round(n.right+20),bottom:Math.round(n.bottom-20)},d={left:Math.round(e.left-10),right:Math.round(e.right+10),top:Math.round(e.top+10)};t.style.left=i.right-d.right>300?d.right+"px":d.left-300+"px",t.style.top=i.bottom-d.top>350?d.top+"px":i.bottom-350+"px"},saveEventAdd:function(t,e){this.events[t]={title:e[0],users:e[1],descr:e[2]}}},Controller={clickButtonEarlier:function(){Model.setEarlierMonth(),View.changeLableMonth(),View.markItemMonth(),View.changeLableYear(),View.markItemYear(),View.showSelectedMonth(),View.removeMarkColCalendar(),View.hidePopupAdd(),View.hidePopupEdit()},clickButtonLater:function(){Model.setLaterMonth(),View.changeLableMonth(),View.markItemMonth(),View.changeLableYear(),View.markItemYear(),View.showSelectedMonth(),View.removeMarkColCalendar(),View.hidePopupAdd(),View.hidePopupEdit()},clickButtonCurrent:function(){Model.setCurrentDate(),View.changeLableMonth(),View.markItemMonth(),View.changeLableYear(),View.markItemYear(),View.showSelectedMonth(),View.removeMarkColCalendar(),View.hidePopupAdd(),View.hidePopupEdit()},clickButtonMonth:function(t){t.target==View.buttonMonth&&View.popupMonth.classList.toggle("active"),t.target!=View.buttonMonth&&View.popupMonth.classList.contains("active")&&View.popupMonth.classList.remove("active")},clickItemMonth:function(t){var e=t.target.innerHTML,n=View.listMonth.indexOf(e.toLowerCase());Model.setSelectedMonth(n),View.changeLableMonth(),View.markItemMonth(),View.showSelectedMonth(),View.removeMarkColCalendar(),View.hidePopupAdd(),View.hidePopupEdit()},clickButtonYear:function(t){t.target==View.buttonYear&&View.popupYear.classList.toggle("active"),t.target!=View.buttonYear&&View.popupYear.classList.contains("active")&&View.popupYear.classList.remove("active")},clickItemYear:function(t){Model.setSelectedYear(t.target.innerHTML),View.changeLableYear(),View.markItemYear(),View.showSelectedMonth(),View.removeMarkColCalendar(),View.hidePopupAdd(),View.hidePopupEdit()},clickButtonFastAdd:function(){View.popupFastAdd.classList.toggle("active"),View.removeMarkColCalendar(),View.hidePopupAdd(),View.hidePopupEdit()},clickButtonCloseFastAdd:function(){View.popupFastAdd.classList.remove("active"),View.statusFastAdd.innerHTML=""},clickButtonCancelFastAdd:function(){View.popupFastAdd.classList.remove("active"),View.inputFastAdd.value="",View.statusFastAdd.innerHTML=""},clickButtonSumbitFastAdd:function(){var t=View.inputFastAdd.value;""==t&&View.showStatusFastAdd("error","Заполните поле");var e=Model.saveEventFastAdd(t);"busy"==e?(View.showStatusFastAdd("info","День занят"),View.changeLableMonth(),View.markItemMonth(),View.showSelectedMonth()):e&&"busy"!=e?(View.showStatusFastAdd("succses","Данные добавлены"),View.changeLableMonth(),View.markItemMonth(),View.showSelectedMonth(),t=""):View.showStatusFastAdd("error","Данные некорректны")},clickButtonUpdate:function(){Model.refresh(),View.removeMarkColCalendar(),View.hidePopupAdd(),View.hidePopupEdit(),View.popupFastAdd.classList.remove("active"),View.statusFastAdd.innerHTML=""},clickColCalendar:function(t){if(t.target.classList.contains("col"))e=t.target;else var e=t.target.parentNode;View.popupFastAdd.classList.remove("active"),View.statusFastAdd.innerHTML="",e.classList.contains("focus")?(View.removeMarkColCalendar(),e.classList.contains("event")?View.hidePopupEdit():View.hidePopupAdd()):(View.markColCalendar(e),View.hidePopupAdd(),View.hidePopupEdit(),e.classList.contains("event")?(Model.setCoordinates(View.popupEdit,e.getBoundingClientRect(),e.parentNode.parentNode.getBoundingClientRect()),View.showPopupEdit(e)):(Model.setCoordinates(View.popupAdd,e.getBoundingClientRect(),e.parentNode.parentNode.getBoundingClientRect()),View.showPopupAdd(e)))},clickButtonCloseAdd:function(){View.removeMarkColCalendar(),View.hidePopupAdd()},clickButtonCancelAdd:function(){View.removeMarkColCalendar(),View.hidePopupAdd()},clickButtonSumbitAdd:function(t){var e=t.target.parentNode.parentNode.getAttribute("date-index");if(""==View.inputTitleAdd.value)View.showStatusFastAdd("error",'Заполните поле "Событие"');else{var n=[View.inputTitleAdd.value,View.inputUserAdd.value,View.textareaAdd.value];Model.saveEventAdd(e,n),View.removeMarkColCalendar(),View.hidePopupAdd(),View.showSelectedMonth()}},clickButtonCloseEdit:function(){View.removeMarkColCalendar(),View.hidePopupEdit()},clickButtonDeleteEdit:function(t){var e=t.target.parentNode.parentNode.getAttribute("date-index");console.log(e)},clickButtonSumbitEdit:function(t){var e=t.target.parentNode.parentNode.getAttribute("date-index");console.log(e)}};({init:function(){View.createItemsYear(),View.createItemsMonth(),Model.refresh(),this.main(),this.event()},main:function(){},event:function(){View.buttonFastAdd.addEventListener("click",Controller.clickButtonFastAdd),View.buttonUpdate.addEventListener("click",Controller.clickButtonUpdate),View.buttonCloseFastAdd.addEventListener("click",Controller.clickButtonCloseFastAdd),View.buttonCancelFastAdd.addEventListener("click",Controller.clickButtonCancelFastAdd),View.buttonSubmitFastAdd.addEventListener("click",Controller.clickButtonSumbitFastAdd),View.buttonEarlier.addEventListener("click",Controller.clickButtonEarlier),View.buttonLater.addEventListener("click",Controller.clickButtonLater),View.buttonCurrent.addEventListener("click",Controller.clickButtonCurrent),window.addEventListener("click",function(t){Controller.clickButtonMonth(t)});for(t=0;t<View.listPopupMonth.length;t++)View.listPopupMonth[t].addEventListener("click",function(t){Controller.clickItemMonth(t)});window.addEventListener("click",function(t){Controller.clickButtonYear(t)});for(var t=0;t<View.listPopupYear.length;t++)View.listPopupYear[t].addEventListener("click",function(t){Controller.clickItemYear(t)});View.buttonCloseAdd.addEventListener("click",Controller.clickButtonCloseAdd),View.buttonCancelAdd.addEventListener("click",Controller.clickButtonCancelAdd),View.buttonSubmitAdd.addEventListener("click",function(t){Controller.clickButtonSumbitAdd(t)}),View.buttonCloseEdit.addEventListener("click",Controller.clickButtonCloseEdit),View.buttonDeleteEdit.addEventListener("click",function(t){Controller.clickButtonDeleteEdit(t)}),View.buttonSubmitEdit.addEventListener("click",function(t){Controller.clickButtonSumbitEdit(t)})}}).init();