"use strict";var View={listDay:["понедельник","вторник","среда","четверг","пятница","суббота","воскресенье"],listMonth:["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"],listMonths:["января","февраля","марта","апреля","майа","июня","июля","августа","сентября","октября","ноября","декабря"],buttonFastAdd:document.getElementById("btn-fast-add"),pupopFastAdd:document.getElementById("popup-fast-add"),inputFastAdd:document.getElementById("pfa-input"),statusFastAdd:document.getElementById("pfa-status"),buttonSubmitFastAdd:document.getElementById("pfa-btn-submit"),buttonCancelFastAdd:document.getElementById("pfa-btn-canсel"),buttonCloseFastAdd:document.getElementById("pfa-btn-close"),buttonUpdate:document.getElementById("btn-update"),inputSerach:document.getElementById("input-search"),buttonEarlier:document.getElementById("btn-earlier"),buttonLater:document.getElementById("btn-later"),buttonCurrent:document.getElementById("btn-current"),buttonMonth:document.getElementById("btn-month"),pupopMonth:document.getElementById("popup-month"),listPupopMonth:document.getElementsByClassName("pm-item"),buttonYear:document.getElementById("btn-year"),pupopYear:document.getElementById("popup-year"),listPupopYear:document.getElementsByClassName("py-item"),calendar:document.getElementById("calendar"),colsCalendar:document.getElementsByClassName("col"),createDivWithClass:function(t){var e=document.createElement("div");return e.classList.add(t),e},changeLableMonth:function(){var t=this.listMonth[Model.date.getMonth()];this.buttonMonth.innerHTML=t[0].toUpperCase()+t.slice(1)},createItemsMonth:function(){this.pupopMonth.innerHTML="";for(var t=0;t<this.listMonth.length;t++){var e=this.createDivWithClass("pm-item"),n=this.listMonth[t];e.setAttribute("id","pm-item"),e.innerHTML=n[0].toUpperCase()+n.slice(1),this.pupopMonth.appendChild(e)}},markItemMonth:function(){for(var t=0;t<this.listPupopMonth.length;t++)this.listPupopMonth[t].classList.remove("active");this.listPupopMonth[Model.date.getMonth()].classList.add("active")},changeLableYear:function(){this.buttonYear.innerHTML=Model.date.getFullYear()},createItemsYear:function(){var t=Model.getListYear();this.pupopYear.innerHTML="";for(var e=0;e<t.length;e++){var n=this.createDivWithClass("py-item");n.setAttribute("id","py-item"),n.innerHTML=t[e],this.pupopYear.appendChild(n)}},markItemYear:function(){for(var t=0;t<this.listPupopYear.length;t++)this.listPupopYear[t].innerHTML==Model.date.getFullYear()?this.listPupopYear[t].classList.add("active"):this.listPupopYear[t].classList.remove("active")},showSelectedMonth:function(){var t=Model.getDaysCurrentMonth(),e=t.length/7,n=0,i=t[17][1];this.colsCalendar=[],this.calendar.innerHTML="";for(var a=0;a<e;a++){for(var s=this.createDivWithClass("row"),o=0;o<7;o++){var r=this.createDivWithClass("col");r.setAttribute("date-index",Model.getIndexDate(t[n])),t[n][1]!=i&&r.classList.add("unfit"),Model.ifToday(t[n])&&r.classList.add("current");var l=this.createDivWithClass("col-date");if(l.innerHTML=0==a?this.listDay[o]+", "+t[n][2]:t[n][2],r.appendChild(l),Model.ifEvent(t[n])){r.classList.add("event");var d=this.createDivWithClass("col-title"),c=this.createDivWithClass("col-descr"),u=Model.getEvent(t[n]),h=""!=u.users?u.users:u.descr;d.innerHTML=u.title,c.innerHTML=h.length>40?h.slice(0,41)+" ...":h,r.appendChild(d),r.appendChild(c)}s.appendChild(r),n++}this.calendar.appendChild(s)}Model.refreshColsEvent()},showStatusFastAdd:function(t,e){this.statusFastAdd.className="status",this.statusFastAdd.classList.add(t),this.statusFastAdd.innerHTML=e}},Model={date:new Date,events:{},readJsonFile:function(){for(var t=JSON.parse(FILE),e=0;e<t.length;e++){var n=t[e].date;this.events[n]={title:t[e].title,users:t[e].users,descr:t[e].descr}}},ifToday:function(t){var e=new Date,n=e.getFullYear(),i=e.getMonth(),a=e.getDate();return t[0]==n&&t[1]==i&&t[2]==a},ifEvent:function(t){return this.getIndexDate(t)in this.events},getEvent:function(t){return this.events[this.getIndexDate(t)]},refresh:function(){Model.setCurrentDate(),Model.readJsonFile(),View.changeLableMonth(),View.markItemMonth(),View.changeLableYear(),View.markItemYear(),View.showSelectedMonth()},setCurrentDate:function(){this.date=new Date},setSelectedMonth:function(t){this.date.setMonth(t)},setSelectedYear:function(t){this.date.setFullYear(t)},setEarlierMonth:function(){this.date.setMonth(this.date.getMonth()-1)},setLaterMonth:function(){this.date.setMonth(this.date.getMonth()+1)},getDaysCurrentMonth:function(){var t=[],e=this.date.getMonth(),n=new Date;n.setFullYear(this.date.getFullYear(),e,1);var i=0==n.getDay()?7:n.getDay();n.setDate(n.getDate()-i+1);for(a=0;a<7;a++)t.push([n.getFullYear(),n.getMonth(),n.getDate()]),n.setDate(n.getDate()+1);for(;n.getMonth()==e;)for(var a=0;a<7;a++)t.push([n.getFullYear(),n.getMonth(),n.getDate()]),n.setDate(n.getDate()+1);return t},getIndexDate:function(t){var e=1==(""+t[1]).length?"0"+(t[1]+1):t[1]+1,n=1==(""+t[2]).length?"0"+t[2]:t[2];return[t[0],e,n].join("")},getDateIndex:function(t){var e=[];return e.push(+t.slice(0,4)),e.push(+("0"==t[4]?t[5]:t.slice(4,6))-1),e.push(+("0"==t[6]?t[7]:t.slice(6))),e},getListYear:function(){for(var t=[],e=+this.date.getFullYear()-20;e<+this.date.getFullYear()+50;e++)t.push(e);return t},splitStrFastAdd:function(t){var e=t.split(", ")[0].split(" ");return[e[1].toLowerCase(),+e[0],t.slice(t.indexOf(",")+2)]},ifCorrectFastAdd:function(t){var e=this.splitStrFastAdd(t);return e[1]>0&&e[1]<32&&(-1!=View.listMonths.indexOf(e[0])||-1!=View.listMonth.indexOf(e[0]))},addEventFastAdd:function(t){var e,n=this.splitStrFastAdd(t);-1!=View.listMonths.indexOf(n[0])?e=View.listMonths.indexOf(n[0]):-1!=View.listMonth.indexOf(n[0])&&(e=View.listMonth.indexOf(n[0]));var i=this.getIndexDate([this.date.getFullYear(),e,n[1]]);return this.setSelectedMonth(e),!this.ifEvent(this.getDateIndex(i))&&(this.events[i]={title:n[2],users:"",descr:""},!0)},refreshColsEvent:function(){View.colsCalendar=document.getElementsByClassName("col");for(var t=0;t<View.colsCalendar.length;t++)View.colsCalendar[t].addEventListener("click",function(t){Controller.clickColCalendar(t)})}},Controller={clickButtonEarlier:function(){Model.setEarlierMonth(),View.changeLableMonth(),View.markItemMonth(),View.changeLableYear(),View.markItemYear(),View.showSelectedMonth()},clickButtonLater:function(){Model.setLaterMonth(),View.changeLableMonth(),View.markItemMonth(),View.changeLableYear(),View.markItemYear(),View.showSelectedMonth()},clickButtonCurrent:function(){Model.setCurrentDate(),View.changeLableMonth(),View.markItemMonth(),View.changeLableYear(),View.markItemYear(),View.showSelectedMonth()},clickButtonMonth:function(t){t.target==View.buttonMonth&&View.pupopMonth.classList.toggle("active"),t.target!=View.buttonMonth&&View.pupopMonth.classList.contains("active")&&View.pupopMonth.classList.remove("active")},clickItemMonth:function(t){var e=t.target.innerHTML,n=View.listMonth.indexOf(e.toLowerCase());Model.setSelectedMonth(n),View.changeLableMonth(),View.markItemMonth(),View.showSelectedMonth()},clickButtonYear:function(t){t.target==View.buttonYear&&View.pupopYear.classList.toggle("active"),t.target!=View.buttonYear&&View.pupopYear.classList.contains("active")&&View.pupopYear.classList.remove("active")},clickItemYear:function(t){Model.setSelectedYear(t.target.innerHTML),View.changeLableYear(),View.markItemYear(),View.showSelectedMonth()},clickButtonFastAdd:function(){View.pupopFastAdd.classList.toggle("active")},clickButtonCloseFastAdd:function(){View.pupopFastAdd.classList.remove("active"),View.statusFastAdd.innerHTML=""},clickButtonCancelFastAdd:function(){View.pupopFastAdd.classList.remove("active"),View.inputFastAdd.value="",View.statusFastAdd.innerHTML=""},clickButtonSumbitFastAdd:function(){var t=View.inputFastAdd.value;""==t?View.showStatusFastAdd("error","Заполните поле"):Model.ifCorrectFastAdd(t)?Model.addEventFastAdd(t)?(View.showStatusFastAdd("succses","Данные добавлены"),View.changeLableMonth(),View.markItemMonth(),View.showSelectedMonth(),t=""):(View.showStatusFastAdd("info","День занят"),View.changeLableMonth(),View.markItemMonth(),View.showSelectedMonth()):View.showStatusFastAdd("error","Данные некорректны")},clickButtonUpdate:function(){Model.refresh()},clickColCalendar:function(t){if(t.target.classList.contains("col"))e=t.target;else var e=t.target.parentNode;console.log(e.getBoundingClientRect())}};({init:function(){View.createItemsYear(),View.createItemsMonth(),Model.refresh(),this.main(),this.event()},main:function(){},event:function(){View.buttonFastAdd.addEventListener("click",Controller.clickButtonFastAdd),View.buttonUpdate.addEventListener("click",Controller.clickButtonUpdate),View.buttonCloseFastAdd.addEventListener("click",Controller.clickButtonCloseFastAdd),View.buttonCancelFastAdd.addEventListener("click",Controller.clickButtonCancelFastAdd),View.buttonSubmitFastAdd.addEventListener("click",Controller.clickButtonSumbitFastAdd),View.buttonEarlier.addEventListener("click",Controller.clickButtonEarlier),View.buttonLater.addEventListener("click",Controller.clickButtonLater),View.buttonCurrent.addEventListener("click",Controller.clickButtonCurrent),window.addEventListener("click",function(t){Controller.clickButtonMonth(t)});for(t=0;t<View.listPupopMonth.length;t++)View.listPupopMonth[t].addEventListener("click",function(t){Controller.clickItemMonth(t)});window.addEventListener("click",function(t){Controller.clickButtonYear(t)});for(var t=0;t<View.listPupopYear.length;t++)View.listPupopYear[t].addEventListener("click",function(t){Controller.clickItemYear(t)})}}).init();